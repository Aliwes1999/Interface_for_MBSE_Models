{% extends "base.html" %} {% block title %}Manage Project{% endblock %} {% block
content %} {% if not project %}
<h1 class="mt-5 pt-3">Neues Projekt erstellen</h1>
<p>Hier kannst du neue Projekte erstellen.</p>

<form method="POST" class="mb-4">
  <div class="row">
    <div class="col-md-9">
      <input
        type="text"
        name="project_name"
        class="form-control"
        placeholder="Projektname"
        required
      />
    </div>
    <div class="col-md-3">
      <button type="submit" class="btn btn-primary">Projekt erstellen</button>
    </div>
  </div>
</form>

<a href="{{ url_for('main.home') }}" class="btn btn-secondary"
  >Zurück zur Startseite</a
>

{% else %}
<!-- Project View -->
<div class="mb-3">
  <a
    href="{{ url_for('main.manage_project', project_id=project.id) }}"
    class="btn btn-secondary"
  >
    <i class="bi bi-arrow-left"></i> Zurück zum Projekt-Einstieg
  </a>
  <a 
    href="{{ url_for('main.project_overview', project_id=project.id, active_tab='files') }}" 
    class="btn btn-secondary"
  >
    <i class="bi bi-folder"></i> Archiv
  </a>
  <a href="{{ url_for('main.home') }}" class="btn btn-secondary">
    <i class="bi bi-house"></i> Zurück zur Startseite
  </a>
  <button
    class="btn btn-warning ms-2"
    type="button"
    data-bs-toggle="modal"
    data-bs-target="#shareProjectModal"
  >
    <i class="bi bi-share"></i> Projekt teilen
  </button>
</div>
<!-- Shared Users Display -->
{% if project.shared_with %}
<div class="alert alert-info mb-3">
  <strong><i class="bi bi-people"></i> Geteilt mit:</strong>
  {% for user in project.shared_with %}
  <span class="badge bg-info me-1">
    {{ user.email }}
    <form
      method="POST"
      action="{{ url_for('main.unshare_project', project_id=project.id, user_id=user.id) }}"
      class="d-inline"
      onsubmit="return confirm('Freigabe für {{ user.email }} wirklich entfernen?')"
    >
      <button
        type="submit"
        class="btn-close btn-close-white ms-1"
        aria-label="Close"
        style="font-size: 0.5rem"
      ></button>
    </form>
  </span>
  {% endfor %}
</div>
{% endif %}

<h2 class="mt-4 mb-4">Projekt: {{ project.name }}</h2>

<!-- Archive Content (no tabs) -->
<div class="mt-4">
  {% if show_archive %}
  <!-- Archive Section -->
    <div class="card">
      <div class="card-header"><i class="bi bi-folder"></i> Datei-Archiv</div>
      <div class="card-body">
        <div class="mb-4">
          <h5>Neu generierte Anforderungen</h5>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Beschreibung</th>
                  <th>Anzahl</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody>
                {% set generated_files =
                project.files|selectattr('file_type','equalto','generated')|list %}
                {% for gen_file in generated_files %}
                {% set file_versions = gen_file.generated_versions|list %}
                {% if file_versions|length > 0 %}
                <tr>
                  <td>
                    <i class="bi bi-stars text-success me-2"></i>
                    Generiert am {{ gen_file.created_at.strftime('%d.%m.%Y %H:%M') }}
                  </td>
                  <td>
                    <span class="badge bg-success">{{ file_versions|length }} Anforderungen</span>
                  </td>
                  <td>
                    <a href="{{ url_for('main.project_overview', project_id=project.id, file_id=gen_file.id) }}" class="btn btn-sm btn-outline-primary me-2">
                      <i class="bi bi-eye"></i> Anzeigen
                    </a>
                    <form method="POST" action="{{ url_for('main.delete_project_file', file_id=gen_file.id) }}" class="d-inline" onsubmit="return confirm('Generierte Anforderungen wirklich löschen?');">
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i> Löschen
                      </button>
                    </form>
                  </td>
                </tr>
                {% endif %}
                {% endfor %}
                {% if generated_files|length == 0 or (generated_files|selectattr('generated_versions')|list|length == 0) %}
                <tr>
                  <td colspan="3" class="text-center text-muted">
                    Noch keine generierten Anforderungen vorhanden.
                    <a href="{{ url_for('agent.agent_page', project_id=project.id) }}" class="btn btn-sm btn-outline-success ms-2">
                      <i class="bi bi-robot"></i> Jetzt generieren
                    </a>
                  </td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="mb-3">
          <h5>Für KI hochgeladene Dateien</h5>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Dateiname</th>
                  <th>Datum</th>
                  <th>Hochgeladen von</th>
                  <th>Anforderungen</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody>
                {% set uploads =
                project.files|selectattr('file_type','equalto','upload')|list %}
                {% for file in uploads %}
                <tr>
                  <td>
                    <i
                      class="bi bi-file-earmark-arrow-up text-primary me-2"
                    ></i>
                    {{ file.filename }}
                  </td>
                  <td>{{ file.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                  <td>
                    {% if file.created_by %}{{
                    file.created_by.email.split('@')[0] }}{% else %}-{% endif %}
                  </td>
                  <td>
                    {% set file_versions = file.generated_versions|list %}
                    {% if file_versions|length > 0 %}
                    <span class="badge bg-info">{{ file_versions|length }} Anforderungen</span>
                    {% else %}
                    <span class="badge bg-secondary">Keine</span>
                    {% endif %}
                  </td>
                  <td>
                    {% set file_versions = file.generated_versions|list %}
                    {% if file_versions|length > 0 %}
                    <a
                      href="{{ url_for('main.project_overview', project_id=project.id, file_id=file.id) }}"
                      class="btn btn-sm btn-outline-primary me-2"
                      ><i class="bi bi-eye"></i> Anzeigen</a
                    >
                    {% endif %}
                    <a
                      href="{{ url_for('main.download_file', file_id=file.id) }}"
                      class="btn btn-sm btn-outline-secondary me-2"
                      ><i class="bi bi-download"></i> Download</a
                    >
                    {% if file.filename.endswith(('.xlsx', '.xls')) %}
                    <a
                      href="{{ url_for('agent.agent_page', project_id=project.id, preload_file=file.id) }}"
                      class="btn btn-sm btn-outline-success me-2"
                      ><i class="bi bi-robot"></i> Nochmal laden</a
                    >
                    {% endif %}
                    <form method="POST" action="{{ url_for('main.delete_project_file', file_id=file.id) }}" class="d-inline" onsubmit="return confirm('Datei wirklich löschen?');">
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i> Löschen
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %} {% if uploads|length == 0 %}
                <tr>
                  <td colspan="5" class="text-center text-muted">
                    Keine für KI hochgeladenen Dateien vorhanden.
                  </td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% else %}
  <!-- Requirements View -->
    {% if source_file %}
    <div class="alert alert-info mb-3">
      <i class="bi bi-info-circle me-2"></i>
      Anzeige der Anforderungen aus: <strong>{{ source_file.filename }}</strong>
      <a href="{{ url_for('main.project_overview', project_id=project.id) }}" class="btn btn-sm btn-outline-secondary ms-3">
        <i class="bi bi-arrow-left"></i> Alle Anforderungen anzeigen
      </a>
    </div>
    {% endif %}
    
    <!-- Pass custom columns to JavaScript -->
    <script>
      window.PROJECT_CUSTOM_COLUMNS = {{ custom_columns|tojson|safe }};
    </script>

    <!-- Dynamic Columns Section -->
    <div class="card mb-4">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <span>Aktuelle Spalten</span>
        <div>
          <a
            href="{{ url_for('main.export_excel', project_id=project.id) }}"
            class="btn btn-sm btn-success me-2"
          >
            <i class="bi bi-file-earmark-excel"></i> Export als Excel
          </a>
          <button
            class="btn btn-sm btn-info me-2"
            type="button"
            id="toggle-quantifizierbar"
            onclick="toggleQuantifizierbareColumn()"
          >
            <i class="bi bi-eye" id="quantifizierbar-icon"></i> Quantifizierbar
          </button>
          <button
            class="btn btn-sm btn-primary"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#addColumnForm"
          >
            <i class="bi bi-plus-circle"></i> Spalte hinzufügen
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <span class="badge bg-secondary me-1"
            ><i class="bi bi-lock-fill"></i> Version</span
          >
          <span class="badge bg-secondary me-1"
            ><i class="bi bi-lock-fill"></i> ID</span
          >
          {% for column in custom_columns %}
          <span class="badge bg-primary me-1">
            {{ column }}
            <form
              method="POST"
              action="{{ url_for('main.remove_column', project_id=project.id, column_name=column) }}"
              class="d-inline"
              onsubmit="return confirm('Spalte {{ column }} wirklich löschen?')"
            >
              <button
                type="submit"
                class="btn-close btn-close-white ms-1"
                aria-label="Close"
                style="font-size: 0.5rem"
              ></button>
            </form>
          </span>
          {% endfor %}
          <span class="badge bg-secondary me-1"
            ><i class="bi bi-lock-fill"></i> Benutzer</span
          >
          <span class="badge bg-secondary me-1"
            ><i class="bi bi-lock-fill"></i> Aktionen</span
          >
          <span class="badge bg-secondary me-1"
            ><i class="bi bi-lock-fill"></i> Aktionen</span
          >
        </div>
        <div class="collapse" id="addColumnForm">
          <form
            method="POST"
            action="{{ url_for('main.add_column', project_id=project.id) }}"
            class="row g-3"
          >
            <div class="col-md-8">
              <input
                type="text"
                class="form-control"
                name="column_name"
                placeholder="Neue Spalte (z.B. 'Priorität')"
                required
              />
            </div>
            <div class="col-md-4">
              <button type="submit" class="btn btn-primary">Hinzufügen</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- FILTER SECTION - CLEARLY VISIBLE -->
    <div class="card mb-3 border-primary">
      <div
        class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
      >
        <span><i class="bi bi-funnel-fill"></i> <strong>FILTER</strong></span>
        <button
          class="btn btn-sm btn-light"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#filterSection"
        >
          Filter ein/ausblenden
        </button>
      </div>
      <div class="collapse show" id="filterSection">
        <div class="card-body bg-light">
          <div class="row g-3">
            <div class="col-md-4">
              <label for="filterText" class="form-label fw-bold"
                >Textsuche</label
              >
              <input
                type="text"
                class="form-control"
                id="filterText"
                placeholder="Suche in Title und Beschreibung..."
              />
            </div>
            <div class="col-md-2">
              <label for="filterStatus" class="form-label fw-bold"
                >Status</label
              >
              <select class="form-select" id="filterStatus">
                <option value="">Alle</option>
                <option value="Offen">Offen</option>
                <option value="In Arbeit">In Arbeit</option>
                <option value="Fertig">Fertig</option>
              </select>
            </div>
            <div class="col-md-2">
              <label for="filterCategory" class="form-label fw-bold"
                >Kategorie</label
              >
              <select class="form-select" id="filterCategory">
                <option value="">Alle</option>
              </select>
            </div>
            <div class="col-md-4" id="dynamicFiltersContainer"></div>
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <button class="btn btn-primary" id="applyFilters">
                <i class="bi bi-check-circle"></i> Filter anwenden
              </button>
              <button class="btn btn-secondary" id="resetFilters">
                <i class="bi bi-x-circle"></i> Zurücksetzen
              </button>
              <span class="ms-3 badge bg-info" id="filterResultCount"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Requirements Table -->
    <div class="card">
      <div class="card-header">Anforderungen</div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th style="width: 5%">ID</th>
                <th style="width: 15%">title</th>
                <th style="width: 15%">description</th>
                <th class="quantifizierbar-column" style="width: 8%;">Quantifizierbar</th>
                <th style="width: 8%">category</th>
                {% for column in custom_columns %}
                {% if column not in ['title', 'description', 'category'] %}
                <th style="width: 8%">{{ column }}</th>
                {% endif %}
                {% endfor %}
                <th style="width: 5%">Version</th>
                <th style="width: 8%">Status</th>
                <th style="width: 10%">Benutzer</th>
                <th style="width: 20%">Aktionen</th>
              </tr>
            </thead>
            <tbody>
              {% if req_with_versions %} {% for req, versions in
              req_with_versions %}
              <tr id="req-row-{{ req.id }}" data-req-id="{{ req.id }}">
                <td>{{ loop.index }}</td>
                <td class="custom-data-cell" data-column="title">
                  {{ versions[-1].get_custom_data().get('title', '–') }}
                </td>
                <td class="custom-data-cell" data-column="description">
                  {{ versions[-1].get_custom_data().get('description', '\u2013') }}
                </td>
                <td class="quantifizierbar-column">
                  <div class="btn-group btn-group-sm" role="group">
                    <button 
                      type="button" 
                      class="btn quantifizierbar-btn {% if versions[-1].get_custom_data().get('quantifizierbar') == 'ja' %}btn-success active{% else %}btn-outline-success{% endif %}"
                      onclick="setQuantifizierbar({{ req.id }}, {{ versions[-1].id }}, 'ja')"
                      data-req-id="{{ req.id }}"
                      data-value="ja"
                    >
                      <i class="bi bi-check-lg"></i>
                    </button>
                    <button 
                      type="button" 
                      class="btn quantifizierbar-btn {% if versions[-1].get_custom_data().get('quantifizierbar') == 'nein' %}btn-danger active{% else %}btn-outline-danger{% endif %}"
                      onclick="setQuantifizierbar({{ req.id }}, {{ versions[-1].id }}, 'nein')"
                      data-req-id="{{ req.id }}"
                      data-value="nein"
                    >
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </td>
                <td class="custom-data-cell" data-column="category">
                  {{ versions[-1].get_custom_data().get('category', '–') }}
                </td>
                {% for column in custom_columns %}
                {% if column not in ['title', 'description', 'category'] %}
                <td class="custom-data-cell" data-column="{{ column }}">
                  {{ versions[-1].get_custom_data().get(column, "–") }}
                </td>
                {% endif %}
                {% endfor %}
                <td>
                  <select
                    class="form-select form-select-sm version-selector"
                    data-req-id="{{ req.id }}"
                  >
                    {% for ver in versions %}
                    <option
                      value="{{ ver.version_index }}"
                      {%
                      if
                      loop.last
                      %}selected{%
                      endif
                      %}
                    >
                      {{ ver.version_label }}
                    </option>
                    {% endfor %}
                  </select>
                </td>
                <td class="status-cell">
                  <span class="badge" style="background-color: {{ versions[-1].get_status_color() }}">
                    {{ versions[-1].status }}
                  </span>
                </td>
                <td class="user-cell">
                  {% if versions[-1].created_by %}
                  <small
                    class="text-muted"
                    title="Erstellt: {{ versions[-1].created_at.strftime('%d.%m.%Y %H:%M') }}{% if versions[-1].last_modified_by %} | Geändert: {{ versions[-1].last_modified_by.email }}{% endif %}"
                  >
                    <i class="bi bi-person"></i> {{
                    versions[-1].created_by.email.split('@')[0] }}
                  </small>
                  {% else %}
                  <small class="text-muted">–</small>
                  {% endif %}
                </td>
                <td class="actions-cell">
                  <form
                    method="POST"
                    action="{{ url_for('main.toggle_block_requirement', version_id=versions[-1].id) }}"
                    class="d-inline"
                  >
                    <button
                      type="submit"
                      class="btn btn-sm {% if versions[-1].is_blocked %}btn-success{% else %}btn-warning{% endif %} mb-1"
                    >
                      <i
                        class="bi {% if versions[-1].is_blocked %}bi-unlock{% else %}bi-lock{% endif %}"
                      ></i>
                      {% if versions[-1].is_blocked %}Freigeben{% else
                      %}Blockieren{% endif %}
                    </button>
                  </form>
                  <button
                    class="btn btn-sm btn-outline-primary mb-1 edit-requirement-btn"
                    data-req-id="{{ req.id }}"
                    data-version-id="{{ versions[-1].id }}"
                    {%
                    if
                    versions[-1].is_blocked
                    %}disabled{%
                    endif
                    %}
                  >
                    <i class="bi bi-pencil"></i> Bearbeiten
                  </button>
                  <form
                    method="POST"
                    action="{{ url_for('main.regenerate_requirement', req_id=req.id) }}"
                    class="d-inline"
                  >
                    <button
                      type="submit"
                      class="btn btn-sm btn-outline-success mb-1"
                      {%
                      if
                      versions[-1].is_blocked
                      %}disabled{%
                      endif
                      %}
                    >
                      <i class="bi bi-stars"></i> Neu generieren
                    </button>
                  </form>
                  <form
                    method="POST"
                    action="{{ url_for('main.delete_requirement_version', version_id=versions[-1].id) }}"
                    class="d-inline delete-version-form"
                    data-req-id="{{ req.id }}"
                  >
                    <button
                      type="submit"
                      class="btn btn-sm btn-outline-danger mb-1"
                      onclick="return confirm('Möchten Sie Version {{ versions[-1].version_label }} wirklich löschen?')"
                      {%
                      if
                      versions[-1].is_blocked
                      %}disabled{%
                      endif
                      %}
                    >
                      <i class="bi bi-trash"></i> Löschen
                    </button>
                  </form>
                  <div class="d-none" id="versions-data-{{ req.id }}">
                    {% for ver in versions %}
                    <div
                      class="version-data"
                      data-version-index="{{ ver.version_index }}"
                      data-version-id="{{ ver.id }}"
                      data-title="{{ ver.title }}"
                      data-description="{{ ver.description }}"
                      data-category="{{ ver.category or '' }}"
                      data-status="{{ ver.status }}"
                      data-status-color="{{ ver.get_status_color() }}"
                      data-custom-data="{{ ver.get_custom_data_json()|safe }}"
                    ></div>
                    {% endfor %}
                  </div>
                </td>
              </tr>
              {% endfor %} {% else %}
              <tr>
                <td
                  colspan="{{ 4 + custom_columns|length }}"
                  class="text-center"
                >
                  Noch keine Anforderungen vorhanden. Nutzen Sie den
                  <a
                    href="{{ url_for('agent.agent_page', project_id=project.id) }}"
                    >KI-Agenten</a
                  >.
                </td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endif %}
  </div>
</div>

<!-- Modals -->
<div class="modal fade" id="shareProjectModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Projekt teilen</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form
        method="POST"
        action="{{ url_for('main.share_project', project_id=project.id) }}"
      >
        <div class="modal-body">
          <div class="mb-3">
            <label for="shareEmail" class="form-label">E-Mail-Adresse</label>
            <input
              type="email"
              class="form-control"
              id="shareEmail"
              name="email"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Abbrechen
          </button>
          <button type="submit" class="btn btn-primary">Teilen</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="importExcelModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Excel importieren</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form
        method="POST"
        action="{{ url_for('main.import_excel', project_id=project.id) }}"
        enctype="multipart/form-data"
      >
        <div class="modal-body">
          <input
            type="file"
            class="form-control"
            name="excel_file"
            accept=".xlsx,.xls"
            required
          />
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Abbrechen
          </button>
          <button type="submit" class="btn btn-primary">Importieren</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editRequirementModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Anforderung bearbeiten</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form id="editRequirementForm" method="POST">
        <div class="modal-body">
          <input type="hidden" id="editVersionId" name="version_id" />
          <input
            type="hidden"
            id="editSaveType"
            name="save_type"
            value="intermediate"
          />
          <div class="mb-3">
            <label for="editTitle" class="form-label">Title *</label>
            <input
              type="text"
              class="form-control"
              id="editTitle"
              name="title"
              required
            />
          </div>
          <div class="mb-3">
            <label for="editDescription" class="form-label"
              >Beschreibung *</label
            >
            <textarea
              class="form-control"
              id="editDescription"
              name="description"
              rows="4"
              required
            ></textarea>
          </div>
          <div class="mb-3">
            <label for="editCategory" class="form-label">Kategorie</label>
            <input
              type="text"
              class="form-control"
              id="editCategory"
              name="category"
            />
          </div>
          <div id="dynamicColumnsContainer"></div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Abbrechen
          </button>
          <button
            type="submit"
            class="btn btn-warning"
            onclick="document.getElementById('editSaveType').value='intermediate'"
          >
            Zwischenspeichern
          </button>
          <button
            type="submit"
            class="btn btn-success"
            onclick="document.getElementById('editSaveType').value='final'"
          >
            Speichern (Fertig)
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Toggle Quantifizierbar column visibility
function toggleQuantifizierbareColumn() {
  const columns = document.querySelectorAll('.quantifizierbar-column');
  const icon = document.getElementById('quantifizierbar-icon');
  
  // Check current state - if display is 'none' or empty string means visible
  const isVisible = columns[0].style.display !== 'none';
  
  columns.forEach(col => {
    col.style.display = isVisible ? 'none' : '';
  });
  
  // Update icon
  if (isVisible) {
    // Now hidden
    icon.classList.remove('bi-eye');
    icon.classList.add('bi-eye-slash');
  } else {
    // Now visible
    icon.classList.remove('bi-eye-slash');
    icon.classList.add('bi-eye');
  }
}

// Set quantifizierbar value
function setQuantifizierbar(reqId, versionId, value) {
  // Send AJAX request to update custom_data
  fetch(`/requirement/version/${versionId}/update_quantifizierbar`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ quantifizierbar: value })
  })
  .then(response => response.json())
  .then(data => {
    if (data.ok) {
      // Update button states
      const row = document.querySelector(`tr[data-req-id="${reqId}"]`);
      const buttons = row.querySelectorAll('.quantifizierbar-btn');
      
      buttons.forEach(btn => {
        btn.classList.remove('btn-success', 'btn-danger', 'active');
        
        if (btn.dataset.value === value) {
          btn.classList.add('active');
          if (value === 'ja') {
            btn.classList.add('btn-success');
          } else {
            btn.classList.add('btn-danger');
          }
        } else {
          if (btn.dataset.value === 'ja') {
            btn.classList.add('btn-outline-success');
          } else {
            btn.classList.add('btn-outline-danger');
          }
        }
      });
    }
  })
  .catch(error => console.error('Error:', error));
}
</script>

<script src="{{ url_for('static', filename='project.js') }}"></script>

{% endif %} {% endblock %}
